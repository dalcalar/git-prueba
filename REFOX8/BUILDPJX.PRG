PARAMETER REFLIST
* Xitech (Europe) 1997
* Visual FoxPro 3.0 & 5.0 project file reconstruction from ReFox .LFN log file
* revised Aug 98, support for longnames where possible
IF !'Visual'$version()
	WAIT WINDOW 'Visual FoxPro Projects only'
	RETURN
ENDIF
IF FILE('&REFLIST')
	CREATE TABLE REFOXP.PXI (FNAME C(12), XPAD1 C(1), PJTYPE C(1), XPAD2 C(1), LONGNAME C(128))
ELSE
	WAIT WINDOW 'No ReFox Log file found (.LFN)'
	RETURN
ENDIF
LFA = ALIAS()
APPEND FROM (REFLIST) TYPE SDF
* FILES EXTENSION LIST
EXIN = 'FXP TXT ICO MSK DBF DBC FPT CDX VCX VCT FRX FRT SCX SCT LBX LBT MPX MPR MNT BMP MSK FLL APP QPX CUR H  '
* CORRESPONDING PROJECT FILE CODES (out is dropped)
EXOUT= 'P   T   x   x   D   d   out x   V   out R   out K   out B   out M   P   out x   x   L   Z   Q   x   T  '
ISTABLE = 'DBF MNX FRX LBX SCX VCX'
SELECT 0
PROJSTUB = LEFT(REFLIST,LEN(ALLTRIM(REFLIST))-4)
PROJSTUB = SUBSTR(PROJSTUB,RAT('\',PROJSTUB)+1)
PROJF = PROJSTUB+'.PJX'
CREATE PROJECT (PROJF) NOWAIT
PROJW = "Project Manager - "+PROPER(projstub)
KEYBOARD ('R')
RELEASE WIND (PROJW)
USE (PROJF) ALIAS (PROJSTUB) EXCL

SELECT 0
UNU = SELECT()

SELECT (LFA)
SCAN
	EXT = UPPER(RIGHT(ALLTRIM(FNAME),3))
	L = .T.
	K = UPPER(LEFT(FNAME,AT('.',FNAME)-1))
	K2 = UPPER(SUBSTR(LONGNAME,2,AT('.',LONGNAME)-2))

	* TEST FOR FILE MNX AND IF NOT EXIST USE MPR !
	* substitute source extensions for FXP and MPX
	N = IIF(EXT='FXP',LOWER(K+'.PRG'),IIF(EXT='MPX',IIF(FILE(K+'.MNX'),LOWER(K+'.MNX'),LOWER(K+'.MPR')),ALLTRIM(FNAME)))
	N2 = IIF(EXT='FXP',LOWER(K2+'.PRG'),IIF(EXT='MPX',IIF(FILE(K2+'.MNX'),LOWER(K2+'.MNX'),LOWER(K2+'.MPR')),ALLTRIM(CHRTRAN(LONGNAME,CHR(34),''))))

	IF FILE('&N2')
		N = N2
		K = K2
	ENDIF
	IF '.MPR'$UPPER(N)
		EXT = 'MPR'
	ENDIF
	T = IIF(EMPTY(SUBSTR(EXOUT,AT(EXT,EXIN),1)),'x',SUBSTR(EXOUT,AT(EXT,EXIN),1))
	IF UPPER(RIGHT(N,3))$ISTABLE
		IF FILE('&N')
			* get code pages for tables
			USE (N) IN (UNU)
			CP = CPDBF(UNU)
			USE IN (UNU)
			SELECT (LFA)
		ELSE
			CP = CPCURRENT()
		ENDIF
	ELSE
		CP = 0
	ENDIF
	
	WAIT WINDOW 'Adding : '+UPPER(N) TIMEOUT 0.1
	PRGMAIN = PJTYPE='M'

	IF .NOT. T=='o'
		IF '5.0'$VERSION()
			IF CP = 0
				INSERT INTO (PROJF) (NAME,TYPE,LOCAL,KEY,MAINPROG) VALUES(N,T,L,K,PRGMAIN)
			ELSE
				INSERT INTO (PROJF) (NAME,TYPE,LOCAL,KEY,MAINPROG,CPID) VALUES(N,T,L,K,PRGMAIN,CP)
			ENDIF
		ELSE
			IF CP = 0
				INSERT INTO (PROJF) (NAME,TYPE,KEY,MAINPROG) VALUES(N,T,K,PRGMAIN)
			ELSE
				INSERT INTO (PROJF) (NAME,TYPE,KEY,MAINPROG,CPID) VALUES(N,T,K,PRGMAIN,CP)
			ENDIF
		ENDIF
	ENDIF
ENDSCAN
WAIT WINDOW 'Project '+PROJF+' Build Completed !' TIMEOUT 1
USE
DELETE FILE REFOXP.PXI

SELECT (PROJSTUB)
USE

MODIFY PROJECT (PROJF) NOWAIT









